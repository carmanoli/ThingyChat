<!-- Ficheiro: pages/editor.html (Adaptado para Anima√ß√µes) -->

<link rel="stylesheet" href="styles/editor.css" />

<h1 class="mb-4">Animation Editor</h1>

<div class="editor-container">
  <!-- Nome da Anima√ß√£o e Tamanho da Grelha -->
  <div class="row align-items-center mb-3">
    <div class="col-md-6">
      <label for="animationName" class="form-label">Animation Name:</label>
      <input
        type="text"
        class="form-control"
        id="animationName"
        value="My Animation"
      />
    </div>
    <div class="col-md-6">
      <label class="form-label">Grid Size:</label>
      <div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            name="gridSize"
            id="gridSize8"
            value="8"
            checked
          />
          <label class="form-check-label" for="gridSize8">8x8</label>
        </div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            name="gridSize"
            id="gridSize16"
            value="16"
          />
          <label class="form-check-label" for="gridSize16">16x16</label>
        </div>
      </div>
    </div>
  </div>

  <div id="pixel-grid" class="mx-auto mb-4"></div>

  <!-- NOVO: Formul√°rio para Guardar na Biblioteca (escondido por defeito) -->
  <div id="save-library-form" class="card mb-4 d-none">
    <div class="card-body">
      <h5 class="card-title">Save to Library</h5>
      <div class="input-group">
        <input
          type="text"
          id="save-filename-input"
          class="form-control"
          placeholder="Enter animation name..."
        />
        <button id="confirm-save-btn" class="btn btn-success">Save</button>
        <button id="cancel-save-btn" class="btn btn-secondary">Cancel</button>
      </div>
      <div class="form-text">
        The animation will be saved as a .json file in your selected library
        folder.
      </div>
    </div>
  </div>

  <!-- NOVA: Timeline de Anima√ß√£o -->
  <div class="timeline-container mb-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5>Animation Timeline</h5>

      <!-- NEW: Animation Playback Controls -->
      <div class="animation-controls">
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="checkbox"
            id="loop-checkbox"
            checked
          />
          <label class="form-check-label" for="loop-checkbox">Loop</label>
        </div>
        <select
          id="direction-select"
          class="form-select form-select-sm d-inline-block w-auto"
        >
          <option value="forward">Forward (‚Üí)</option>
          <option value="pingpong">Ping-Pong (‚Üî)</option>
        </select>
      </div>
    </div>

    <div id="timeline-frames" class="timeline-frames">
      <!-- Frames will be added here by JavaScript -->
    </div>
    <div class="mt-2">
      <button id="add-frame-btn" class="btn btn-sm btn-outline-success">
        ‚ûï Add Frame
      </button>
      <button id="clone-frame-btn" class="btn btn-sm btn-outline-info">
        üìã Clone Frame
      </button>
      <button id="play-animation-btn" class="btn btn-sm btn-success">
        ‚ñ∂Ô∏è Play
      </button>
    </div>
  </div>

  <div class="controls-container">
    <!-- NOVO: Seletor de Ferramentas -->
    <div class="mb-4">
      <h5>Tools</h5>
      <div class="btn-group" role="group">
        <button
          type="button"
          id="draw-tool-btn"
          class="btn btn-outline-primary active"
          title="Draw Tool"
        >
          üñåÔ∏è
        </button>
        <button
          type="button"
          id="fill-tool-btn"
          class="btn btn-outline-primary"
          title="Paint Bucket Tool"
        >
          üíß
        </button>
      </div>
    </div>

    <h5>Color Palette & Frame Settings</h5>

    <div id="color-palette" class="mb-4"></div>

    <!-- BOT√ïES DE A√á√ÉO PRINCIPAIS -->
    <div class="mb-4">

            <button id="new-animation-btn" class="btn btn-secondary me-2">‚ú® New Animation</button>
      <button id="clear-btn" class="btn btn-danger me-2">Clear Frame</button>
      <button id="copy-btn" class="btn btn-primary">Copy Arduino Code</button>
      <!-- NOVO BOT√ÉO DE "COLAR" (escondido por defeito) -->
      <button id="paste-photo-btn" class="btn btn-warning d-none">
        üñºÔ∏è Paste Photo
      </button>

      <button id="save-btn" class="btn btn-success">Save to Library</button>
      <!-- Nome corrigido -->
      <button
        id="open-export-btn"
        class="btn btn-info"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#exportOffcanvas"
      >
        Export Image/GIF...
      </button>
    </div>

    <!-- CAIXAS DE C√ìDIGO -->
    <div class="row">
      <div class="col-md-6 mb-3">
        <h5>Arduino Code</h5>
        <textarea
          id="code-output"
          class="form-control"
          rows="10"
          readonly
        ></textarea>
      </div>
      <div class="col-md-6 mb-3">
        <h5>
          JSON Format
          <button id="load-btn" class="btn btn-sm btn-warning float-end">
            Load from JSON
          </button>
        </h5>
        <textarea id="json-output" class="form-control" rows="10"></textarea>
      </div>
    </div>
  </div>
  <!-- Fim do controls-container -->
</div>

<div
  class="offcanvas offcanvas-end"
  tabindex="-1"
  id="exportOffcanvas"
  aria-labelledby="exportOffcanvasLabel"
>
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="exportOffcanvasLabel">Export Options</h5>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="offcanvas"
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body">
    <p>
      Configure the export settings and click "Export" to generate your file.
    </p>

    <!-- Formato do Ficheiro -->
    <div class="mb-3">
      <label class="form-label">Format:</label>
      <div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            name="exportFormat"
            id="formatPNG"
            value="png"
            checked
          />
          <label class="form-check-label" for="formatPNG"
            >PNG (Current Frame)</label
          >
        </div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            name="exportFormat"
            id="formatGIF"
            value="gif"
          />
          <label class="form-check-label" for="formatGIF">Animated GIF</label>
        </div>
      </div>
    </div>

    <!-- Tamanho da Imagem -->
    <div class="mb-3">
      <label for="exportSize" class="form-label">Image Size (pixels):</label>
      <input
        type="number"
        class="form-control"
        id="exportSize"
        value="256"
        step="16"
      />
    </div>

    <!-- Op√ß√µes Adicionais -->
    <div class="mb-3">
      <label class="form-label">Options:</label>
      <div class="form-check">
        <input
          class="form-check-input"
          type="checkbox"
          id="exportGrid"
          checked
        />
        <label class="form-check-label" for="exportGrid"
          >Include Grid Lines</label
        >
      </div>
      <div class="form-check">
        <input
          class="form-check-input"
          type="checkbox"
          id="exportTransparent"
        />
        <label class="form-check-label" for="exportTransparent"
          >Transparent Background</label
        >
      </div>
    </div>

    <div id="export-loader" class="text-center d-none mt-3">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Generating...</span>
      </div>
      <p>Generating GIF, this may take a moment...</p>
    </div>

    <!-- Bot√µes de A√ß√£o -->
    <div class="mt-4">
      <button
        type="button"
        class="btn btn-primary w-100"
        id="confirm-export-btn"
      >
        Export
      </button>
      <button
        type="button"
        class="btn btn-secondary w-100 mt-2"
        data-bs-dismiss="offcanvas"
      >
        Cancel
      </button>
    </div>
  </div>
</div>

<script src="js/editor.js"></script>
